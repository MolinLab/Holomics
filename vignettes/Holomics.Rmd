---
title: "Holomics"
author:
  - name: Katharina Munk and Eva M. Molin
package: Holomics
output: 
  bookdown::html_document2:
    self_contained: yes
    toc: yes
    toc_float: true
    number_sections: false
bibliography: ["bibliography.bib"]
biblio-style: apalike
link-citations: true
vignette: >
  %\VignetteIndexEntry{Holomics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = F,
  fig.align='center', 
  fig.pos= "h"
)
```

<style>
  :root {
    --grey: #f1f3f2;
    --green: #bfc531;
    --blue: #39B6CA;
    --orange: #e6a136;
  }  
         
  h1, h2, h3 {
    color: var(--green);
  }
  
  .list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
      background-color: var(--green);
  }
  .active {
    background-color: var(--green);
  }
  
  .caption{
    color: #777;
    text-align: left;
  }
</style>

<img align="right" src="../inst/app/www/img/logo.png" width=300> 

## Introduction
<b>Holomics</b> is an R Shiny application that allows its users to perform single- and multi-omics analyses by providing a user-friendly interface to upload the different omics datasets and select and run the implemented algorithms. <b>Holomics</b> is built mainly on the R package mixOmics [@rohart2017mixomics]. The app takes the input files, passes them to the mixOmics algorithms and presents the resulting graphs and tables to the user. 

mixOmics provides numerous analysis algorithms for the integrative analysis of omics datasets and the two single-omics algorithms "Principle Component Analysis" (PCA) and "Partial Least Squares Discriminant Analysis" (PLS-DA), the pairwise-omics analysis "sparse Partial Least Squares" (sPLS) and the multi-omics framework DIABLO ("Data Integration Analysis for Biomarker discovery using Latent variable approaches for Omics studies") have been implemented in <b>Holomics</b> so far.


## Getting started
### Installation
#### CRAN
~~~
install.packages("Holomics")
~~~

#### Github
~~~
# Install devtools if it is not already installed
install.packages("devtools")
library(devtools)

# Install Holomics package 
install_github("evasehr/Holomics")
~~~

### Start application
Either with 

~~~
library(Holomics)
runApp()
~~~

or 

~~~
Holomics::runApp()
~~~

### Data preparation
<b>Holomics</b> requires two input file types: first, the dataset(s) with the measured values of the performed omics analysis (e.g. transcriptomics, metabolomics) and second, a metadata file containing the label or class information associated to the samples.

#### Omics dataset
Omics datasets can contain molecular features measured on a continuous scale (e.g. microarray, mass spectrometry-based metabolomics) or sequenced-based count data (e.g. RNA-seq, 16S) that become continuous data after pre-processing and normalisation. Generally, the omics dataset has to be a numeric matrix (basically a count table) in an XLS(X) or CSV file format, where the rows have to be the samples and the columns the measured features.
The first column has to contain the sample names and the first row the feature names. There are generally no restrictions regarding characters and symbols that are allowed in the names. It is recommended to keep the number of special characters and symbols to a minimum. Important is that all the omics datasets that belong together in the analyses have the same samples names. 
If the data contains more variables/columns than excel allows, the matrix also can be uploaded in the transposed format.
Additionally, if the omics dataset contains more than 10.000 features, <b>Holomics</b> will pre-filter the dataset to 10.000 or less features as mixOmics is able to process a maximum of 10.000 features per dataset [@le2023mixomics]. An optional workaround would be to split the omics dataset into two parts, upload them, let the pre-filtering do its work and merge them manually afterwards. 
In addition any wanted/necessary normalisation needs to be done for each omics dataset separately before using <b>Holomics</b>. An example of a valid omics dataset is given in Table \@ref(tab:omicsData).

Table:  (\#tab:omicsData) Example of a omics dataset with sample names in first column and feature names in first row.
```{r message=F}
data <- as.data.frame(readxl::read_excel("data/asv_small.xlsx", col_names = T))
rownames(data) <- data[, 1]   #all rows, first column
data <- data[,-1]
knitr::kable(data)
```


#### Metadata file
The metadate file has to be in an XLS(X) or CSV file format with at least two columns:

* The first column contains the sample names, which have to be exactly the same as in the associated omics datasets. Important is also that the order of the samples is the same in all datasets!

* The second column contains the classes or labels of the samples (e.g. control, treatment1, ...). The column name of the second column has to be the name of the attribute the classes describe (e.g. Quality, Treatment, ...).

* Optional: in the third column, a color code (HEX code or ASCII name) per class can be added, which will be used later in most of the plots. The column name has to be either 'Color' or 'Colorcodes'. Here a link to an easy to use <a href="https://htmlcolorcodes.com/" rel="noreferrer noopener" target="_blank"> Color picker</a>.

An example of a valid metadata file associated to the omics dataset in Table \@ref(tab:omicsData) is given in Table \@ref(tab:labels). 

Table:  (\#tab:labels) Example of a valid metadata file with the mandatory first two columns and the optional column with the color codes.
```{r message=F}
data <- as.data.frame(readxl::read_excel("data/labels.xlsx", col_names = T))
knitr::kable(data)
```

## Workflow overview
To make use of all the functionality provided by <b>Holomics</b>, the below described workflow should be followed. Firstly, the datasets are uploaded where an eventual pre-filtering/pre-processing step takes place. Afterwards, the user should perform the single-omics analysis, where key variables are identified and the datasets are filtered accordingly. With these filtered datasets, the multi-omics analyses is applied to identify correlations between 2-n datasets. 

NOTE: If already  pre-filtered (ideally by <b>Holomics</b> at an earlier time) datasets are uploaded, it is possible to jump directly to the multi-omics analysis step.  

<br>
```{r workflow, fig.cap = "Holomics workflow", out.width="100%"}
knitr::include_graphics("images/workflow.png")
```
<br>

## Data upload
On the upload page the omics datasets and the related metadata (including sample names and labels) are uploaded. On both sub-pages, a collapsible "General information" box is given, which contains some information on how the different input files should look like. Additionally, next to some form fields question marks indicate a tooltip that should help to better understand the meaning of the different fields.

### Upload an omics dataset
To upload an omics dataset (e.g. transcriptomics read count table, metabolomics table, etc.) the user has to select "Omics data" as the data type. Afterwards, the respective .xlsx or .csv file has to be selected via the file upload and a file name must be entered, which will be used later in the analyses pages to identify that dataset easily. Also, the user has to check whether the dataset was already filtered at an earlier time point (through <b>Holomics</b>) or not. If the dataset is coming from microbial community analyses (e.g. if it is an OTU or ASV table), additionally, it is important to check the "contains microbiome data" checkbox, so that a necessary pre-processing step especially for this kind of datasets will be triggered. If the dataset is transposed  (so the samples are columns instead of the rows and the features the rows instead of the columns) the "has transposed format" checkbox needs to be activated.

Next, the user needs to select for which analyses the dataset(s) should be used, whereas the datasets can only be used for multi-omics analyses if the "was previously filtered" checkbox is checked. And, lastly, the name which should be used in the plots for the given omics dataset can be selected or manually entered. Be aware that the file name from before and the "plot name" here do not need to be the same and that the "plot name" can be the same for multiple datasets.

By clicking the save button after filling in the upload form, the dataset will be saved in the <b>Holomics</b> application and a summary of the uploaded information is added to the table on the right side of the page. Figure \@ref(fig:uploadData) shows on the right side the summary of an already uploaded dataset and on the left side the filled-in form with a new dataset before saving it.

<br>
```{r uploadData, fig.cap = "Upload page - omics data", out.width="100%"}
knitr::include_graphics("images/Upload_data.png")
```
<br>

### Upload the metadata file
To upload the metadata file with the labels or class information of each sample the user has to select "Labels/Classes" as the data type. Then the respective .xlsx or .csv file has to be selected. Additionally, a name for the file itself must be entered, which will also be used to differentiate between the different uploaded files. Lastly, if the metadata file also contains a third column with the color codes (HEX codes or ASCII names) per sample the box "Includes color code"  needs to be activated. This color scheme is then used in most of the plots to depict the distinct classes.

To finalize the upload, the save button is clicked and the file is then saved in the <b>Holomics</b> application. A summary of the uploaded information is added to the table on the right side of the page. Figure \@ref(fig:uploadClasses) shows on the right side the summary of an already uploaded metadata file and on the left side the form to upload a new/additional file.

<br>
```{r uploadClasses, fig.cap = "Upload page - labels/classes", out.width="100%"}
knitr::include_graphics("images/Upload_labels.png")
```
<br>

## Single-omics analyses

### Principle Component Analysis
For a first glimpse into the individual omics data and for the necessary feature selection, a Principle Component Analysis (PCA) can be done. Figure \@ref(fig:PCA) shows the PCA page with a test dataset. This page is separated into two parts:

On the left side, the original, but pre-processed and eventually pre-filtered data are depicted. On the top left of the page, the omics dataset that should be analysed is selected together with the corresponding metadata file via the drop-down menus. If the two are not compatible to each other, an error will be printed. The "General information" box shortly explains the PCA concepts and provides some links to additional knowledge sources. In the "Analysis parameters" box the number of components (a value between 2 and 15) that should be used to calculate the PCA can be chosen. Per default, the "Scaling" check box is activated and can be deactivated, if the data don't need any scaling. Below, several plots that present the PCA results using the above set parameters are given.

On the right side, the filtered dataset is shown. To trigger the filtering process the user has to click the "Filter dataset" button at the top-middle of the page. The number of components which are needed to get at least 80\% explained variance for the given dataset are computed. When this number is set, the algorithm determines how many features per component should be used so that the resulting model gives the best result. All the remaining features that are not being used in any component will be removed from the dataset (the original dataset will not be changed) and the filtered dataset will be used to calculate the PCA result used for the plots. The "General information" and "Filtered dataset parameters" box above the plots provide some additional information about the filtered dataset and the general filtering process.

Additionally, the filtered dataset can be downloaded in the XLS(X) file format through the  "Save filtered data" button, which will appear below the "Filter dataset" button after the filtering process has finished. Also, the filtered dataset will automatically be saved in the running <b>Holomics</b> application to be used later for the multi-omics analysis.

NOTE: if the filtering process calculates that the PCA needs more than 15 components to reach the minimum of 80% of the explained variance, the filtering process will be aborted, as the calculation would take too long. It is then recommended to use the PLS-DA function for filtering the dataset instead. 

<br>
```{r PCA, fig.cap = "PCA page", out.width="100%"}
knitr::include_graphics("images/PCA.png")
```
<br>

### Partial Least Squares Discriminant Analysis
The Partial Least Squares Discriminant Analysis (PLS-DA) is also used to analyse single-omics datasets, but in comparison to the PCA, PLS-DA is a supervised method where the information of the corresponding class (or label) is included in its computation. In Figure \@ref(fig:PLSDA), the PLS-DA page with a test dataset is depicted.

On the top left of the page, the omics dataset that should be analysed and the corresponding metadata file are selected. If the two are not compatible, an error will be printed. The "General information" box shortly explains the concepts of the PLS-DA and provides some links to additional knowledge sources. In the "Analysis parameters" box, the number of components (a value between 2 and 15) can be adjusted and whether the dataset should be scaled (default) or not. The resulting plots are presented below. The kind of plots is similar to the ones from the PCA analysis, only that the PLS-DA does not provide a scree plot.

For feature selection, in the middle of the page, the "Filter dataset" button is to be clicked to start the filtering process. The results will be presented on the right side of the page. Compared to the PCA filtering process, the number of components that are set on the left side influences the filtering algorithm. The algorithm tries 1 to n (number of components set) components on the provided dataset and chooses the number where the error rate of the received model was the lowest. Additionally, the number of features per component is calculated and the dataset is filtered to keep only these features. On the right side, the information about the result of the PLS-DA with the filtered dataset and the plots will be presented. The components and the scaling attribute cannot be changed for these plots.

Additionally, the filtered dataset can be downloaded in the XLS(X) file format through the "Save filtered data" button, which will appear after the filtering process has finished. Also, the filtered dataset will automatically be saved in the running <b>Holomics</b> application to be used later for the multi-omics analysis.

<br>
```{r PLSDA, fig.cap = "PLSDA page", out.width="100%"}
knitr::include_graphics("images/PLSDA.png")
```
<br>

## Pairwise omics analysis
For the pairwise omics analysis (integration of two different omics datasets), the sparse Partial Least Squares (sPLS) method is applied. The structure of the page is the same as previously described in the single-omics analysis pages (Figure \@ref(fig:sPLS)). On the top, the two datasets and the corresponding metadata file is selected. 

On the left the user can find some general information, the possibility to manipulate the analysis parameters and the resulting plots. Instead of the filter button described in the PCA and PLS-DA chapter, there is a "Tune parameters" button in the middle of the page. The tuning process is generally similar to the filtering process described in the PCA and PLS-DA chapter. It calculates the ideal number of components for the given datasets and the number of important features per dataset. "Ideal" means the number of components and features per component, where the model, which is built in the background, has the lowest error rate. Like the filtering process of the PLS-DA, the tuning algorithm of the sPLS tests 1 to n (number of components set on the left side) components and chooses one of these as the "ideal". When the tuning process has finished, a switch will appear under the "Tune parameters" button, which, when switched on, leads to the visualisation of the results on the right side of the page. Some general information and the resulting tuned parameters are provided in the boxes above the plots.

<br>
```{r sPLS, fig.cap = "Pairwise analysis / sPLS page", out.width="100%"}
knitr::include_graphics("images/sPLS.png")
```
<br>

## Multi-omics analysis
The multi-omics analysis is done by applying DIABLO framework of mixOmics, which can take two or more datasets as its input and tries to find any correlations between the datasets. The structure of the page (Figure \@ref(fig:DIABLO)) is the same as described in the "Pairwise omics analysis" chapter: 

On the top, the datasets are added and  the corresponding metadata file is selected. On the left side of the page some general information is provided and the possibility to manipulate the analysis parameters is given in the "Analysis parameters" box. Here, the value of the design matrix used by the analysis can be adjusted. The design matrix indicates whether there are prior known or calculated correlations between the datasets, which should be taken into consideration. For now, <b>Holomics</b> only allows to set one correlation value over the entire matrix, which will be used for all pairwise correlations.

The "Tune parameters" button in the middle of the page triggers the tuning process. This process works exactly like the one previously described for sPLS (calculates the ideal number of components and the number of features per dataset). When the tuning process has finished, a switch will appear under the "Tune parameters" button, which, when switched on, leads to the visualisation of the results on the right side of the page based on the tuned parameters.

<br>   
```{r DIABLO, fig.cap = "Multi-omics analysis / DIABLO page", out.width="100%"}
knitr::include_graphics("images/DIABLO.png")
```
<br>

## Help pages
The help pages that can be found in the application provide short descriptions of the used plots as well as the filtering and tuning processes. Additionally, there are several links to the mixOmics website or to multiple papers, where even more detailed information is provided, if desired.

## License
The <b>Holomics</b> package is distributed under GPL-3 (GNU GENERAL PUBLIC LICENSE version 3).

## Cite
<!-- TODO -->
Munk, K., Brader, G. & Molin, E.M. (2023). Holomics: ...tbd.... R package version x.x.x. https://CRAN.R-project.org/package=Holomics

## Session info
```{r, echo = FALSE}
sessionInfo()
```

## References